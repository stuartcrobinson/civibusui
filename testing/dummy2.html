<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Local Election Updates</title>
  <style>
    body {
      font-family: Georgia, serif;
      line-height: 1.7;
      color: #2c3e50;
      max-width: 700px;
      margin: 0 auto;
      padding: 20px;
      background: #fafafa;
    }
    
    header {
      text-align: center;
      padding: 30px 0;
      border-bottom: 1px solid #e0e0e0;
      margin-bottom: 40px;
    }
    
    h1 {
      font-size: 32px;
      margin: 0 0 10px 0;
      font-weight: 400;
    }
    
    .date {
      color: #7f8c8d;
      font-size: 14px;
      font-style: italic;
    }
    
    .content {
      background: white;
      padding: 40px 30px;
      margin-bottom: 40px;
    }
    
    h2 {
      font-size: 24px;
      margin-top: 0;
      font-weight: 400;
    }
    
    .chart-wrapper {
      margin: 30px -30px;
      padding: 0 30px;
      background: #f9f9f9;
    }
  </style>
</head>
<body>
  <header>
    <h1>Fundraising Update</h1>
    <p class="date">March 15, 2024</p>
  </header>

  <div class="content">
    <h2>Q1 Fundraising Trends</h2>
    
    <p>The first quarter fundraising numbers reveal significant momentum shifts in both the mayoral and city council races.</p>

    <!-- ============================================ -->
    <!-- PASTE YOUR CIVIBUS CHART EXPORT CODE HERE   -->
    <!-- ============================================ -->
    
    <div class="chart-wrapper">
      <!-- YOUR CHART CODE GOES HERE -->
      <!-- <p style="padding: 40px; background: white; border: 2px dashed #ddd; text-align: center; color: #999;">
        ðŸ“Š Paste your chart export code here
      </p>
       -->
      <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fundraising by Industry</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { 
      margin: 0; 
      padding: 20px; 
      font-family: system-ui, -apple-system, sans-serif; 
      background: #f9fafb; 
    }
    .chart-container { 
      background: white; 
      padding: 24px; 
      border-radius: 8px; 
      box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
      position: relative;
    }
    .attribution { 
      position: absolute;
      bottom: 8px;
      right: 12px;
      font-size: 12px;
      color: #6b7280;
    }
  </style>
</head>
<body>
  <div class="chart-container">
    <div id="root"></div>
    <div class="attribution">civibus.org</div>
  </div>
  
  <!-- Load React first -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Load PropTypes (required by Recharts) -->
  <script crossorigin src="https://unpkg.com/prop-types@15/prop-types.min.js"></script>
  
  <!-- Load react-is (required by Recharts) -->
  <script crossorigin src="https://unpkg.com/react-is@18/umd/react-is.production.min.js"></script>
  
  <!-- Load Recharts from cdnjs (more reliable) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.12.7/Recharts.min.js"></script>
  
  <script>
    // Wait for everything to load, then check dependencies
    window.addEventListener('load', function() {
      // Verify all dependencies loaded
      if (typeof React === 'undefined') {
        document.getElementById('root').innerHTML = '<div style="color: red; padding: 20px;">Error: React failed to load</div>';
        return;
      }
      if (typeof ReactDOM === 'undefined') {
        document.getElementById('root').innerHTML = '<div style="color: red; padding: 20px;">Error: ReactDOM failed to load</div>';
        return;
      }
      if (typeof Recharts === 'undefined') {
        document.getElementById('root').innerHTML = '<div style="color: red; padding: 20px;">Error: Recharts failed to load</div>';
        return;
      }
      
      const { useState } = React;
      const { ResponsiveContainer, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip } = Recharts;
      
      
function SegmentedBarChart({ data, title, legendLabel, activeFilter }) {
  const [hoveredSegment, setHoveredSegment] = React.useState(null);
  const [hoveredLabel, setHoveredLabel] = React.useState(null);

  const allSegmentTypes = {};
  data.forEach(item => {
    item.segments.forEach(seg => {
      if (!allSegmentTypes[seg.label]) allSegmentTypes[seg.label] = seg.color;
    });
  });
  
  const legendItems = Object.entries(allSegmentTypes).map(([label, color]) => ({ label, color }));

  const matchesFilter = (item, filterId) => {
    if (filterId === 'all') return true;
    if (item.position === filterId) return true;
    if (filterId.includes(':')) {
      const [position, subregion] = filterId.split(':');
      return item.position === position && item.subregion_value === subregion;
    }
    return false;
  };

  const filteredData = activeFilter === 'all' 
    ? data 
    : data.filter(item => matchesFilter(item, activeFilter));

  const maxTotal = Math.max(...filteredData.map(item => 
    item.segments.reduce((sum, seg) => sum + seg.value, 0)
  ));

  const formatDollars = (val) => {
    if (val >= 1000000) return '$' + (val / 1000000).toFixed(1) + 'M';
    if (val >= 1000) return '$' + (val / 1000).toFixed(0) + 'K';
    return '$' + val;
  };

  const processedLabels = filteredData.map(item => item.label);
  const longestNameLength = Math.max(...processedLabels.map(label => label.length));
  const nameWidth = Math.max(longestNameLength * 8 + 8, 80);

  return React.createElement('div', { className: 'w-full' },
    title && React.createElement('h2', { className: 'text-xl font-bold mb-6 text-gray-900' }, title),
    React.createElement('div', { className: 'mb-6 pb-4 border-b border-gray-200' },
      legendLabel && React.createElement('div', { className: 'text-xs font-semibold text-gray-600 mb-3 uppercase' }, legendLabel),
      React.createElement('div', { className: 'flex flex-wrap gap-4' },
        legendItems.map((item, idx) => {
          const isHighlighted = hoveredLabel === item.label;
          return React.createElement('div', {
            key: idx,
            className: 'flex items-center gap-2 transition-all duration-200 cursor-pointer ' + (hoveredLabel && !isHighlighted ? 'opacity-50' : 'opacity-100'),
            onMouseEnter: () => setHoveredLabel(item.label),
            onMouseLeave: () => setHoveredLabel(null)
          },
            React.createElement('div', { className: 'w-4 h-4 flex-shrink-0', style: { backgroundColor: item.color } }),
            React.createElement('span', { className: 'text-sm text-gray-900' }, item.label)
          );
        })
      )
    ),
    React.createElement('div', { className: 'space-y-4' },
      filteredData.map((item, idx) => {
        const itemTotal = item.segments.reduce((sum, s) => sum + s.value, 0);
        return React.createElement('div', { key: idx, className: 'flex items-center gap-4' },
          item.imageUrl && React.createElement('img', {
            src: item.imageUrl,
            alt: item.label,
            className: 'w-10 h-10 object-cover rounded flex-shrink-0'
          }),
          React.createElement('div', { className: 'flex items-center flex-shrink-0', style: { width: nameWidth + 'px' } },
            React.createElement('div', { className: 'text-sm font-semibold text-gray-900 whitespace-nowrap overflow-hidden text-ellipsis' }, item.label)
          ),
          React.createElement('div', { className: 'text-xs text-gray-500 w-3 flex-shrink-0 text-right' }, item.leftLabel || ''),
          React.createElement('div', { className: 'flex-1 min-w-0 relative flex items-center' },
            React.createElement('div', { className: 'flex h-10 w-full' },
              item.segments.map((seg, sIdx) => {
                const segmentId = idx + '-' + sIdx;
                const isSegmentHovered = hoveredSegment === segmentId;
                const isLabelHovered = hoveredLabel === seg.label && !hoveredSegment;
                const isHighlighted = isSegmentHovered || isLabelHovered;
                const segmentPercentOfTotal = (seg.value / itemTotal) * 100;
                const barWidthPercent = (itemTotal / maxTotal) * 100;
                const segmentWidth = (segmentPercentOfTotal / 100) * barWidthPercent;
                
                return React.createElement('div', {
                  key: sIdx,
                  className: 'transition-all duration-200 cursor-pointer relative',
                  style: {
                    width: segmentWidth + '%',
                    backgroundColor: seg.color,
                    filter: isHighlighted ? 'brightness(1.1)' : 'none',
                    transform: isHighlighted ? 'scaleY(1.05)' : 'scaleY(1)'
                  },
                  onMouseEnter: () => {
                    setHoveredSegment(segmentId);
                    setHoveredLabel(seg.label);
                  },
                  onMouseLeave: () => {
                    setHoveredSegment(null);
                    setHoveredLabel(null);
                  }
                },
                  isHighlighted && React.createElement('div', {
                    className: 'absolute -top-12 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-3 py-2 rounded shadow-lg z-20 whitespace-nowrap'
                  },
                    React.createElement('p', { className: 'text-xs font-semibold' }, seg.label),
                    React.createElement('p', { className: 'text-xs text-gray-300' }, formatDollars(seg.value))
                  )
                );
              })
            ),
            React.createElement('div', {
              className: 'absolute text-sm font-semibold text-gray-900 whitespace-nowrap ml-2',
              style: { left: ((itemTotal / maxTotal) * 100) + '%' }
            }, formatDollars(itemTotal))
          ),
          React.createElement('div', { className: 'w-20 flex-shrink-0' })
        );
      })
    )
  );
}
      
      const data = [{"label":"Jane Smith","position":"MAYOR","leftLabel":"D","imageUrl":"https://api.dicebear.com/7.x/shapes/svg?seed=jane","segments":[{"label":"Real Estate","value":850000,"color":"#ef4444"},{"label":"Tech","value":620000,"color":"#f59e0b"},{"label":"Finance","value":530000,"color":"#eab308"},{"label":"Healthcare","value":300000,"color":"#84cc16"},{"label":"Legal","value":200000,"color":"#3b82f6"}]},{"label":"John Doe","position":"MAYOR","leftLabel":"R","imageUrl":"https://api.dicebear.com/7.x/shapes/svg?seed=john","segments":[{"label":"Real Estate","value":480000,"color":"#ef4444"},{"label":"Tech","value":420000,"color":"#f59e0b"},{"label":"Finance","value":380000,"color":"#eab308"},{"label":"Healthcare","value":220000,"color":"#84cc16"},{"label":"Legal","value":100000,"color":"#3b82f6"}]},{"label":"Carol Martinez","position":"CITY COUNCIL","subregion_value":"II","leftLabel":"D","imageUrl":"https://api.dicebear.com/7.x/shapes/svg?seed=carol","segments":[{"label":"Real Estate","value":720000,"color":"#ef4444"},{"label":"Tech","value":580000,"color":"#f59e0b"},{"label":"Finance","value":390000,"color":"#eab308"},{"label":"Healthcare","value":150000,"color":"#84cc16"},{"label":"Legal","value":60000,"color":"#3b82f6"}]},{"label":"Alice Johnson","position":"CITY COUNCIL","subregion_value":"I","leftLabel":"D","imageUrl":"https://api.dicebear.com/7.x/shapes/svg?seed=alice","segments":[{"label":"Real Estate","value":180000,"color":"#ef4444"},{"label":"Tech","value":320000,"color":"#f59e0b"},{"label":"Finance","value":210000,"color":"#eab308"},{"label":"Healthcare","value":120000,"color":"#84cc16"},{"label":"Legal","value":60000,"color":"#3b82f6"}]},{"label":"Bob Wilson","position":"CITY COUNCIL","subregion_value":"I","leftLabel":"D","imageUrl":"https://api.dicebear.com/7.x/shapes/svg?seed=bob","segments":[{"label":"Real Estate","value":210000,"color":"#ef4444"},{"label":"Tech","value":140000,"color":"#f59e0b"},{"label":"Finance","value":120000,"color":"#eab308"},{"label":"Healthcare","value":80000,"color":"#84cc16"},{"label":"Legal","value":30000,"color":"#3b82f6"}]}];
      const chartProps = {"title":"Fundraising by Industry","activeFilter":"MAYOR","legendLabel":"Donor Industries"};
      
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(React.createElement(SegmentedBarChart, {
        data: data,
        ...chartProps
      }));
    });
  </script>
</body>
</html>
    </div>

    <!-- ============================================ -->
    <!-- END OF CHART CODE                           -->
    <!-- ============================================ -->

    <p>Martinez continues to dominate fundraising in District II, while the mayoral race remains competitive with both candidates maintaining strong grassroots support.</p>
  </div>
</body>
</html>